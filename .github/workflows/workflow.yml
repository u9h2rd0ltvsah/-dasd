name: Android Cloud Server Setup

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  setup-android-server:
    runs-on: ubuntu-latest
    container:
      image: budtmo/docker-android:emulator_9.0
      options: --privileged
    steps:
    - name: Setup Android Cloud with Tunnel
      run: |
        echo "Waiting for Android emulator to start..."
        sleep 30
        echo "Installing noVNC for web access..."
        apt-get update && apt-get install -y novnc websockify
        echo "Starting noVNC web interface..."
        websockify --web /usr/share/novnc 6080 localhost:5900 &
        sleep 5
        echo "Installing Cloudflare Tunnel..."
        curl -L -o /tmp/cloudflared https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64
        chmod +x /tmp/cloudflared
        echo "Starting Cloudflare tunnel..."
        /tmp/cloudflared tunnel --url localhost:6080 &
        sleep 5
        echo "Cloudflare tunnel started. Check the logs above for the temporary URL to access noVNC web interface."
        while true; do sleep 60; done
